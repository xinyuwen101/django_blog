{% extends "blog/base.html" %}

{% block content %}

    <div class="post">
        <h3 class="post-title"><a id="post_title" href="{{ post.get_url }}">{{ post.title }}</a></h3>
        <div class="posted">
            <p>
                <small>Posted by
                    <code>{{ post.author }}</code>
                    {% if post.tags.count %}
                        Tags
                        {% for tag in post.tags.all %}
                            <span class="label label-warning">
                        <a id="tag" href="{% url "post:post_list_by_tag" tag.slug %}">{{ tag.name }}</a>
                    </span>
                            {% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    {% endif %}
                </small>
            </p>
            <p><small class="date">
            <span class="flask-moment" data-timestamp="{{ post.publish }}" data-format="format('LL')" data-refresh="0">
                on {{ post.publish }}</span>
            </small>
            </p>
        </div>
        <hr>
        <div class="post_body">
            <p>{{ post.body|linebreaks }}</p>
        </div>
        <hr>
        <h4>Similar posts</h4>
        {% for post in post.tags.similar_objects %}
            <h5>
                <a id="post_title" href="{{ post.get_url }}">{{ post.title }}</a>
            </h5>
        {% empty %}
            There are no similar posts yet.
        {% endfor %}
        <hr>

        {% with comments.count as total_comments %}
            <h4><a name="comments"></a> {{ total_comments }}
                comment{{ total_comments|pluralize }}
            </h4>
        {% endwith %}
        <div class="comment">
            {% for comment in comments %}
                <div class="comment-body">
                    <p>
                        <small>
                            <span class="label label-default">#{{ forloop.counter }}</span>
                            <code>{{ comment.username }}</code>
                            <span class="flask-moment">{{ comment.created }}</span>
                        </small>
                    </p>
                    <div style="overflow: auto;">
                        <p style="white-space: pre-wrap;"> {{ comment.body }}</p>
                    </div>
                </div>
            {% empty %}
                <p>There are no comments yet.</p>
            {% endfor %}

            <hr>
            {% if new_comment %}
                <h2>Your comment has been added.</h2>
            {% else %}
                <h3><a name="commentform"></a>Leave a Comment</h3>
                <form action="#commentform" method="post">
                    {{ comment_form.as_p }}
                    {% csrf_token %}
                    <p><input type="submit" value="Add comment"></p>
                </form>
            {% endif %}

        </div>
    </div>
{% endblock %}
